name: Notify Discord

on:
  push:
  pull_request:
    types: [opened, closed, reopened, synchronize]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord embed via curl
        run: |
          COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
          COMMIT_URL="${{ github.event.head_commit.url }}"
          AUTHOR="${{ github.actor }}"
          REPO="${{ github.repository }}"
          BRANCH="${{ github.ref_name }}"
          EVENT="${{ github.event_name }}"
          TIMESTAMP=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

          PAYLOAD=$(jq -n \
            --arg author "$AUTHOR" \
            --arg repo "$REPO" \
            --arg branch "$BRANCH" \
            --arg commit_message "$COMMIT_MESSAGE" \
            --arg commit_url "$COMMIT_URL" \
            --arg event "$EVENT" \
            --arg timestamp "$TIMESTAMP" \
            '{
              "username": "GitHub Bot ü§ñ",
              "embeds": [
                {
                  "title": "üîî New Event in \($repo)",
                  "description": "üìå Branch: **\($branch)**",
                  "color": 5814783,
                  "fields": [
                    {
                      "name": "üë§ Author",
                      "value": $author,
                      "inline": true
                    },
                    {
                      "name": "üìù Commit Message",
                      "value": $commit_message,
                      "inline": false
                    },
                    {
                      "name": "üîó Commit URL",
                      "value": "[View Commit](\($commit_url))",
                      "inline": false
                    }
                  ],
                  "footer": {
                    "text": "GitHub Actions ‚Ä¢ \($event)"
                  },
                  "timestamp": $timestamp
                }
              ]
            }'
          )

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "${{ secrets.DISCORD_WEBHOOK }}"



# This workflow sends a notification to a Discord channel whenever there is a push or pull request event in the repository.
# It uses a JSON payload to create an embed message that includes details about the commit, such as the author, branch, commit message, and a link to the commit.